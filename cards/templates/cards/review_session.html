{% extends 'base.html' %}

{% block title %}Review Session - Spaced{% endblock %}

{% block extra_head %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/review.css' %}">
{% endblock %}

{% block content %}
<div id="review-app" class="max-w-3xl mx-auto">
    <!-- Progress Bar & Controls -->
    <div class="mb-6">
        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-2">
            <div class="flex justify-between items-center sm:w-auto">
                <span>Progress</span>
                <span id="progress-text" class="sm:hidden">0 / {{ total_due }}</span>
            </div>
            <div class="flex items-center justify-between sm:justify-end gap-4">
                <!-- Text Size Toggle -->
                <div class="flex items-center gap-1 overflow-x-auto">
                    <span class="text-xs mr-1 hidden sm:inline">Size:</span>
                    <button data-size="small" class="size-btn px-2 py-1 rounded text-xs hover:bg-gray-200 dark:hover:bg-gray-700 flex-shrink-0" title="Small">S</button>
                    <button data-size="medium" class="size-btn px-2 py-1 rounded text-xs hover:bg-gray-200 dark:hover:bg-gray-700 flex-shrink-0" title="Medium">M</button>
                    <button data-size="large" class="size-btn px-2 py-1 rounded text-xs hover:bg-gray-200 dark:hover:bg-gray-700 flex-shrink-0" title="Large">L</button>
                    <button data-size="xlarge" class="size-btn px-2 py-1 rounded text-xs hover:bg-gray-200 dark:hover:bg-gray-700 flex-shrink-0" title="Extra Large">XL</button>
                    <button data-size="xxlarge" class="size-btn px-2 py-1 rounded text-xs hover:bg-gray-200 dark:hover:bg-gray-700 flex-shrink-0" title="2X Large">2X</button>
                    <button data-size="xxxlarge" class="size-btn px-2 py-1 rounded text-xs hover:bg-gray-200 dark:hover:bg-gray-700 flex-shrink-0" title="3X Large">3X</button>
                </div>
                <span id="progress-text-desktop" class="hidden sm:inline">0 / {{ total_due }}</span>
            </div>
        </div>
        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
            <div id="progress-bar" class="bg-primary-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
        </div>
    </div>

    <!-- Card Container -->
    <div id="card-container" class="bg-white dark:bg-gray-800 shadow-lg rounded-lg overflow-hidden">
        <!-- Card Content -->
        <div id="card-content" class="p-4 sm:p-8 min-h-[250px] sm:min-h-[300px] flex flex-col">
            <div class="flex-1 flex flex-col items-center justify-center text-center">
                <!-- Front Side -->
                <div id="card-front" class="w-full">
                    <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">Question</p>
                    <p id="front-text" class="card-text text-gray-900 dark:text-white whitespace-pre-wrap"></p>
                    <!-- Type-in input (hidden for non-typein cards) -->
                    <div id="typein-container" class="hidden flex flex-col items-center">
                        <input type="text" id="typein-input" class="typein-input" placeholder="Type your answer..." autocomplete="off">
                        <div id="typein-result" class="hidden typein-result"></div>
                        <div id="expected-answer" class="hidden expected-answer"></div>
                    </div>
                </div>

                <!-- Back Side (hidden initially) -->
                <div id="card-back" class="hidden w-full mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">Answer</p>
                    <p id="back-text" class="card-text text-gray-900 dark:text-white whitespace-pre-wrap"></p>

                    <!-- Notes -->
                    <div id="notes-container" class="hidden mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">Notes</p>
                        <p id="notes-text" class="text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="bg-gray-50 dark:bg-gray-900 px-4 sm:px-8 py-4 sm:py-6">
            <!-- Show Answer Button (for basic/cloze cards) -->
            <div id="show-answer-container" class="flex justify-center">
                <button id="show-answer-btn" class="px-8 py-3 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg shadow transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                    Show Answer
                </button>
            </div>

            <!-- Check Answer Button (for type-in cards) -->
            <div id="check-answer-container" class="hidden flex justify-center">
                <button id="check-answer-btn" class="px-8 py-3 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg shadow transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                    Check Answer
                </button>
            </div>

            <!-- Rating Buttons (hidden initially) -->
            <div id="rating-container" class="hidden">
                <p class="text-center text-sm text-gray-600 dark:text-gray-400 mb-4">How well did you remember?</p>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                    <button data-quality="0" class="rating-btn px-4 py-3 bg-red-100 dark:bg-red-900/50 text-red-800 dark:text-red-200 hover:bg-red-200 dark:hover:bg-red-900 rounded-lg font-medium transition-colors">
                        <span class="block text-lg">Again</span>
                        <span class="block text-xs opacity-75">Forgot</span>
                    </button>
                    <button data-quality="2" class="rating-btn px-4 py-3 bg-orange-100 dark:bg-orange-900/50 text-orange-800 dark:text-orange-200 hover:bg-orange-200 dark:hover:bg-orange-900 rounded-lg font-medium transition-colors">
                        <span class="block text-lg">Hard</span>
                        <span class="block text-xs opacity-75">Struggled</span>
                    </button>
                    <button data-quality="4" class="rating-btn px-4 py-3 bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-200 hover:bg-green-200 dark:hover:bg-green-900 rounded-lg font-medium transition-colors">
                        <span class="block text-lg">Good</span>
                        <span class="block text-xs opacity-75">Recalled</span>
                    </button>
                    <button data-quality="5" class="rating-btn px-4 py-3 bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-200 hover:bg-blue-200 dark:hover:bg-blue-900 rounded-lg font-medium transition-colors">
                        <span class="block text-lg">Easy</span>
                        <span class="block text-xs opacity-75">Instant</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Session Complete (hidden initially) -->
    <div id="session-complete" class="hidden bg-white dark:bg-gray-800 shadow-lg rounded-lg p-8 text-center">
        <div class="mb-6">
            <svg class="mx-auto h-16 w-16 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
        </div>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Session Complete!</h2>
        {% if session_type == 'struggling' %}
        <p class="text-gray-600 dark:text-gray-400 mb-6">Great job! You've reviewed your cards that need work. Keep practicing to improve retention.</p>
        {% else %}
        <p class="text-gray-600 dark:text-gray-400 mb-6">Great job! You've reviewed all due cards.</p>
        {% endif %}

        <div class="grid grid-cols-3 gap-4 mb-8 max-w-md mx-auto">
            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                <div id="stat-reviewed" class="text-2xl font-bold text-gray-900 dark:text-white">0</div>
                <div class="text-sm text-gray-500 dark:text-gray-400">Reviewed</div>
            </div>
            <div class="bg-green-50 dark:bg-green-900/30 rounded-lg p-4">
                <div id="stat-correct" class="text-2xl font-bold text-green-600 dark:text-green-400">0</div>
                <div class="text-sm text-gray-500 dark:text-gray-400">Correct</div>
            </div>
            <div class="bg-red-50 dark:bg-red-900/30 rounded-lg p-4">
                <div id="stat-again" class="text-2xl font-bold text-red-600 dark:text-red-400">0</div>
                <div class="text-sm text-gray-500 dark:text-gray-400">Again</div>
            </div>
        </div>

        <div class="flex justify-center space-x-4">
            <a href="{% url 'dashboard' %}" class="px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                Back to Dashboard
            </a>
            {% if deck %}
            <a href="{% url 'deck_detail' deck.pk %}" class="px-6 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-colors">
                View Deck
            </a>
            {% endif %}
        </div>
    </div>

    <!-- Keyboard shortcuts hint -->
    <div class="mt-4 text-center text-sm text-gray-500 dark:text-gray-400">
        <span class="hidden sm:inline">Keyboard shortcuts: </span>
        <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">Space</kbd>/<kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">Enter</kbd> show/check answer,
        <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs">1-4</kbd> rate card
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/review.js' %}"></script>
<script>
    initReviewSession({
        cards: {{ cards_json|safe }},
        defaultTextSize: '{{ text_size }}',
        celebrationAnimations: {{ celebration_animations|yesno:"true,false" }},
        csrfToken: '{{ csrf_token }}'
    });
</script>
{% endblock %}
